[Rainmeter]
Update=1000
BackgroundMode=3
Background=#@#Background.png
BackgroundMargins=0,34,0,14
DynamicWindowSize=1
OnRefreshAction=[!UpdateMeasure *] [!UpdateMeter *] [!Redraw]

[Metadata]
Name=MEDIA PLAYER
Author=Maria & Louis
Information=Displays media info with album art and progress bar (YouTube Music compatible).
License=Creative Commons BY-NC-SA 3.0
Version=1.0.0

[Variables]
fontName=Trebuchet MS
fontSizeTitle=10
fontSizeInfo=7
colorText=255,255,255,205
colorBar=235,170,0,255
coverDefault=#@#placeholder-square.png

coverSize=80
totalWidth=190

; --- MEASURES ---

[MeasureTitle]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=Title
Substitute="":"NO TITLE","0":"NO TITLE"

[MeasureArtist]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=Artist
Substitute="":"UNKNOWN ARTIST","0":"UNKNOWN ARTIST"

; --- PROXY FIX: START ---
; STEP 1: This measure gets the raw, unfiltered data from the plugin. It might be a URL or the "0".
; This measure is NEVER used by a meter.
[MeasureCoverRAW]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=Cover

; STEP 2: This measure reads the value from MeasureCoverRAW and cleans it.
[MeasureCoverClean]
Measure=String
String=[MeasureCoverRAW]
; This Substitute is applied to the string value from the RAW measure.
; It replaces "0" with an empty string "" BEFORE the image meter ever sees it.
Substitute="0":""
DynamicVariables=1
; --- PROXY FIX: END ---

[MeasurePosition]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=Position
Substitute="":"0:00"

[MeasureDuration]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=Duration
Substitute="":"0:00"

[MeasureProgress]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=Progress
IfCondition=MeasureState = 0
IfTrueAction=[!DisableMeasure "MeasureProgress"]
IfFalseAction=[!EnableMeasure "MeasureProgress"]
DynamicVariables=1

[MeasureState]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=State
OnChangeAction=[!UpdateMeasure *] [!UpdateMeter *] [!Redraw]

[MeasurePlayPause]
Measure=Plugin
Plugin=WebNowPlaying
PlayerType=PlayPause

; --- STYLES ---
; (No changes needed in styles)
[styleTitle]
StringAlign=Center
StringCase=Upper
StringStyle=Bold
StringEffect=Shadow
FontEffectColor=0,0,0,50
FontColor=#colorText#
FontFace=#fontName#
FontSize=#fontSizeTitle#
AntiAlias=1
ClipString=2

[styleInfo]
StringAlign=Center
StringCase=None
StringStyle=Bold
StringEffect=Shadow
FontEffectColor=0,0,0,20
FontColor=#colorText#
FontFace=#fontName#
FontSize=#fontSizeInfo#
AntiAlias=1
ClipString=1

[styleButton]
W=20
H=20
ImageTint=#colorText#
AntiAlias=1
DynamicVariables=1

[styleProgressBar]
BarColor=#colorBar#
BarOrientation=HORIZONTAL
SolidColor=255,255,255,15
H=1

; --- METERS ---
[meterTitleHeader]
Meter=String
MeterStyle=styleTitle
X=100
Y=12
W=190
H=18
Text=MEDIA

[meterCover]
Meter=Image
; -- PROXY FIX -- This meter now points to the CLEANED measure.
MeasureName=MeasureCoverClean
; -- The meter's own DefaultPath will now work, because it will receive an empty string from the clean measure.
DefaultPath=#coverDefault#
X=62
Y=35
W=#coverSize#
H=#coverSize#

[meterSongTitle]
Meter=String
MeterStyle=styleTitle
MeasureName=MeasureTitle
X=100
Y=120
W=190
H=14
Text=%1
DynamicVariables=1

[meterArtist]
Meter=String
MeterStyle=styleInfo
MeasureName=MeasureArtist
X=100
Y=135
W=190
H=14
Text=%1
DynamicVariables=1

; --- PLAYBACK BUTTONS ---
[meterPrev]
Meter=Image
MeterStyle=styleButton
ImageName=#@#previous.png
X=60
Y=155
LeftMouseUpAction=[!CommandMeasure MeasurePlayPause "Previous"]

[meterPlay]
Meter=Image
MeterStyle=styleButton
ImageName=#@#resume.png
X=90
Y=155
MeasureName=MeasureState
Hidden=([MeasureState] = 1)
LeftMouseUpAction=[!CommandMeasure MeasurePlayPause "PlayPause"]
DynamicVariables=1

[meterPause]
Meter=Image
MeterStyle=styleButton
ImageName=#@#pause.png
X=90
Y=155
MeasureName=MeasureState
Hidden=([MeasureState] <> 1)
LeftMouseUpAction=[!CommandMeasure MeasurePlayPause "PlayPause"]
DynamicVariables=1

[meterNext]
Meter=Image
MeterStyle=styleButton
ImageName=#@#next.png
X=120
Y=155
LeftMouseUpAction=[!CommandMeasure MeasurePlayPause "Next"]

[meterProgressBar]
Meter=Bar
MeasureName=MeasureProgress
MeterStyle=styleProgressBar
X=10
Y=180
W=170
DynamicVariables=1
